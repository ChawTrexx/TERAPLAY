<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Home</title>
  <style>
    :root{--bg:#0b0b0b;--card:#141414;--muted:#9a9a9a;--accent:#5b4dff}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:#fff}
    header{display:flex;align-items:center;justify-content:space-between;padding:12px 18px;border-bottom:1px solid rgba(255,255,255,0.04)}
    .logo{font-weight:800;color:var(--accent);letter-spacing:2px}
    
    .controls{
      display:flex;gap:8px;flex-wrap:wrap;padding:18px;
      justify-content:center
    }
    .chip{
      background:rgba(255,255,255,0.03);
      padding:6px 12px;
      border-radius:20px;
      cursor:pointer;
      font-size:14px;
      border:1px solid rgba(255,255,255,0.02)
    }
    .chip.active{
      background:linear-gradient(90deg,var(--accent),#8a6bff);
      color:#fff
    }

    .container{max-width:900px;margin:18px auto;padding:0 12px}
    .card{background:var(--card);border-radius:14px;padding:12px;overflow:hidden;margin-bottom:14px}
    .thumb{width:100%;height:260px;border-radius:12px;object-fit:cover;background:#000}
    .meta{display:flex;justify-content:space-between;align-items:center;margin-top:10px}
    .title{font-size:16px;font-weight:600}
    .views{color:var(--muted);font-size:13px}

    .actions{display:flex;gap:10px;margin-top:10px}
    button{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 14px;border-radius:10px;color:#fff;cursor:pointer;font-size:14px}
    button.primary{background:var(--accent);border:0}
    @media(max-width:700px){.thumb{height:200px}}

    /* NEW PAGINATION (ONLY PREV/NEXT) */
    .pagination{
      display:flex;
      justify-content:center;
      align-items:center;
      gap:14px;
      margin:25px 0;
    }
    .pagination button{
      background:#1c1c1c;
      border:1px solid rgba(255,255,255,0.08);
      padding:10px 18px;
      border-radius:30px;
      cursor:pointer;
      font-size:15px;
      color:#fff;
      transition:.25s;
    }
    .pagination button:hover{
      background:linear-gradient(90deg,#6b5cff,#8e79ff);
      transform:scale(1.05);
      box-shadow:0 0 12px rgba(108,74,255,0.6);
    }
    .pagination button:disabled{
      opacity:.4;
      cursor:not-allowed;
      background:#111;
    }
    .page-info{
      font-size:15px;
      color:#b1a9ff;
      font-weight:600;
      background:#1a1a1a;
      padding:8px 16px;
      border-radius:20px;
      border:1px solid rgba(255,255,255,0.05);
      box-shadow:0 0 5px rgba(92,73,255,0.3);
    }
  </style>
</head>
<body>
<header><div class="logo">TEEN18 disk</div></header>

<div class="controls">
  <div class="chip" data-filter="recent">Recent</div>
  <div class="chip active" data-filter="trending">Trending</div>
  <div class="chip" data-filter="oldest">Oldest</div>
</div>

<main class="container" id="list"></main>
<div id="pagination"></div>

<script type="module">
import { db } from "./firebase.js";
import { ref, onValue } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

let VIDEOS = [];
let currentPage = 1;
const ITEMS_PER_PAGE = 20;

const list = document.getElementById('list');
const pagination = document.getElementById('pagination');

function escapeHtml(s){
  return (s||'').replace(/&/g,'&amp;')
                .replace(/</g,'&lt;')
                .replace(/>/g,'&gt;');
}

// üî• SHARE BUTTON FIXED
function shareVideo(id){
  const url = `${window.location.origin}/Watch.html?id=${id}`;
  if (navigator.share){
    navigator.share({
      title:"Watch this video",
      text:"üî• Viral video ‚Äî watch now!",
      url:url
    }).catch(()=>{});
  } else {
    prompt("Copy video link:", url);
  }
}
window.shareVideo = shareVideo;

function render(filter='trending'){
  let items=[...VIDEOS];
  if(filter==='recent') items.sort((a,b)=>b.timestamp-a.timestamp);
  else if(filter==='oldest') items.sort((a,b)=>a.timestamp-b.timestamp);
  else items.sort((a,b)=>b.views-a.views);

  const totalPages=Math.ceil(items.length/ITEMS_PER_PAGE);
  const start=(currentPage-1)*ITEMS_PER_PAGE;
  const paginated=items.slice(start,start+ITEMS_PER_PAGE);

  list.innerHTML='';
  for(const v of paginated){
    list.innerHTML +=`
      <div class="card">
        <a href="Watch.html?id=${v.id}">
          <img class="thumb" src="${v.thumbnail}" />
        </a>
        <div class="meta">
          <div class="title">${escapeHtml(v.title)}</div>
          <div class="views">${Number(v.views).toLocaleString()} views</div>
        </div>
        <div class="actions">
          <a href="Watch.html?id=${v.id}"><button class="primary">Play</button></a>
          <button onclick="shareVideo('${v.id}')">Share</button>
        </div>
      </div>`;
  }

  // ‚≠ê NEW PAGINATION UI
  pagination.innerHTML = `
    <div class="pagination">
      <button onclick="goPage(${Math.max(1,currentPage-1)})" ${currentPage===1?'disabled':''}>‚óÄ Prev</button>
      <div class="page-info">Page ${currentPage} / ${totalPages}</div>
      <button onclick="goPage(${Math.min(totalPages,currentPage+1)})" ${currentPage===totalPages?'disabled':''}>Next ‚ñ∂</button>
    </div>`;
}

window.goPage=function(p){
  currentPage=p;
  const active=document.querySelector('.chip.active')?.dataset.filter||'trending';
  render(active);
}

onValue(ref(db,'videos'), snap=>{
  VIDEOS=[];
  snap.forEach(ch=>{
    const d=ch.val();
    d.id=ch.key;
    d.views=d.views||0;
    d.timestamp=d.timestamp||Date.now();
    VIDEOS.push(d);
  });
  render('trending');
});

document.querySelectorAll('.chip').forEach(c=>{
  c.addEventListener('click',()=>{
    document.querySelectorAll('.chip').forEach(x=>x.classList.remove('active'));
    c.classList.add('active');
    currentPage=1;
    render(c.dataset.filter);
  });
});
</script>
</body>
</html>
