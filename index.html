<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Global Chat</title>

<script type="module">
  // Import Firebase functions
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-analytics.js";
  import { getDatabase, ref, push, onChildAdded, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";

  // Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyALvB7xgYjhBZi5y2JSBamDysNdgIm2mEo",
    authDomain: "wechat-54b07.firebaseapp.com",
    databaseURL: "https://wechat-54b07-default-rtdb.firebaseio.com",
    projectId: "wechat-54b07",
    storageBucket: "wechat-54b07.firebasestorage.app",
    messagingSenderId: "221397223557",
    appId: "1:221397223557:web:40703bc5c13dc1b2ab81ec",
    measurementId: "G-XJRYS6DHLR"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const db = getDatabase(app);

  window.addEventListener("DOMContentLoaded", () => {
    const chatList = document.getElementById("chat-list");
    const msgInput = document.getElementById("msg");
    const sendBtn = document.getElementById("sendBtn");

    // Unique client ID per device
    if (!localStorage.getItem("clientId")) {
      localStorage.setItem("clientId", Date.now() + "-" + Math.random().toString(36).substring(2));
    }
    const clientId = localStorage.getItem("clientId");

    // Add message to chat
    function addMessage(msg) {
      const li = document.createElement("li");
      li.textContent = msg.text;
      li.style.padding = "8px 12px";
      li.style.margin = "5px 0";
      li.style.maxWidth = "70%";
      li.style.borderRadius = "15px";
      li.style.wordBreak = "break-word";
      li.style.backgroundColor = msg.clientId === clientId ? "#6fbced" : "#ccc";
      li.style.color = msg.clientId === clientId ? "#fff" : "#000";
      li.style.alignSelf = msg.clientId === clientId ? "flex-end" : "flex-start";
      chatList.appendChild(li);
      chatList.scrollTop = chatList.scrollHeight;
    }

    // Send message
    function sendMessage() {
      const text = msgInput.value.trim();
      if (!text) return;

      push(ref(db, "messages"), {
        text,
        clientId,
        timestamp: serverTimestamp()
      });

      msgInput.value = "";
    }

    sendBtn.addEventListener("click", sendMessage);
    msgInput.addEventListener("keydown", e => { if (e.key === "Enter") sendMessage(); });

    // Listen for all messages
    onChildAdded(ref(db, "messages"), snapshot => {
      const data = snapshot.val();
      addMessage(data);
    });
  });
</script>

</head>
<body style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;margin:0;font-family:sans-serif;background:#f0f0f0;">

<h2>Global Chat</h2>
<ul id="chat-list" style="list-style:none;padding:10px;width:90%;max-width:500px;height:60vh;overflow-y:auto;display:flex;flex-direction:column;"></ul>
<div style="display:flex;width:90%;max-width:500px;margin-top:10px;">
  <input type="text" id="msg" placeholder="Type a message..." style="flex:1;padding:10px;font-size:16px;">
  <button id="sendBtn" style="padding:10px 15px;font-size:16px;margin-left:5px;">Send</button>
</div>

</body>
</html>
