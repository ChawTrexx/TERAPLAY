<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sound Buttons UI</title>

<style>
body {
  background:#f5f5f5;
  margin:0;
  font-family:Arial, sans-serif;
}

.header {
  background:#e91e63;
  color:white;
  padding:15px;
  font-size:24px;
  font-weight:bold;
  text-align:center;
}

.grid {
  display:grid;
  grid-template-columns:repeat(3, 1fr);
  gap:20px;
  padding:20px;
}

.sound-box {
  text-align:center;
}

.title {
  font-size:14px;
  margin:8px 0;
  font-weight:bold;
}

.btn-row {
  display:flex;
  justify-content:center;
  gap:10px;
  margin-top:8px;
}

.btn-row img {
  width:22px;
  height:22px;
  cursor:pointer;
}

/* Toggle Upload Box */
#uploadBox {
  background:#fff;
  padding:20px;
  margin:15px;
  border-radius:10px;
  display:none;
  box-shadow:0 4px 10px rgba(0,0,0,0.1);
}

/* Upload Box button */
.toggle-btn {
  background:#e91e63;
  color:white;
  padding:12px;
  width:90%;
  margin:10px auto;
  display:block;
  border:none;
  border-radius:10px;
  font-size:18px;
}
</style>
</head>
<body>

<div class="header">MyInstants Clone</div>

<button class="toggle-btn" onclick="toggleUpload()">Upload Sound ▼</button>

<div id="uploadBox">
  <input type="text" id="title" placeholder="Enter title" style="width:100%;padding:10px;border-radius:8px;border:1px solid #ccc;">
  <br><br>
  <input type="file" id="fileInput" accept="audio/mp3,audio/mpeg" style="width:100%;">
  <br><br>
  <button onclick="uploadSound()" style="width:100%;padding:10px;background:#4caf50;color:white;border:none;border-radius:8px;font-size:16px;">Upload</button>
</div>

<div class="grid" id="soundGrid"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getDatabase, ref, set, onValue, remove } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";
import { getStorage, ref as sRef, uploadBytesResumable, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyBEo_4YpF_vLH8WtacVKU2YC1BaoIZ7TtI",
  authDomain: "videohosting-13776.firebaseapp.com",
  databaseURL: "https://videohosting-13776-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "videohosting-13776",
  storageBucket: "videohosting-13776.appspot.com",
  messagingSenderId: "992909501546",
  appId: "1:992909501546:web:3728b48ec4727a5679d613"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const storage = getStorage(app);

/* ---------------- Upload Toggle ---------------- */
function toggleUpload(){
  const box = document.getElementById("uploadBox");
  box.style.display = box.style.display === "none" ? "block" : "none";
}

/* ---------------- Upload Sound ---------------- */
window.uploadSound = async () => {
  const title = document.getElementById("title").value.trim();
  const file = document.getElementById("fileInput").files[0];
  if(!title) return alert("Enter title");
  if(!file) return alert("Choose mp3 file");

  const id = Date.now();
  const filePath = `sounds/${id}_${file.name}`;
  const storageRef = sRef(storage, filePath);

  // Upload with progress
  const uploadTask = uploadBytesResumable(storageRef, file);

  uploadTask.on('state_changed', 
    (snapshot) => {
      // Optional: Progress can be shown here
    }, 
    (error) => {
      alert("Upload failed: " + error.message);
    }, 
    async () => {
      const url = await getDownloadURL(uploadTask.snapshot.ref);
      await set(ref(db, `sounds/${id}`), {id, title, url, filePath});
      addSoundToUI({id, title, url, filePath});
      alert("Uploaded!");
      // Reset inputs
      document.getElementById("title").value = "";
      document.getElementById("fileInput").value = "";
    }
  );
};

/* ---------------- Load Sounds ---------------- */
const soundGrid = document.getElementById("soundGrid");

onValue(ref(db, "sounds"), (snap)=>{
  soundGrid.innerHTML = "";
  snap.forEach(child=>{
    addSoundToUI(child.val());
  });
});

function addSoundToUI(s){
  soundGrid.innerHTML += `
    <div class="sound-box">
      <button onclick="new Audio('${s.url}').play()">
        <div style="width:83px;height:83px;background:#4fc3f7;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:24px;color:white;">▶️</div>
      </button>
      <div class="title">${s.title}</div>
      <div class="btn-row">
        <img src="https://cdn-icons-png.flaticon.com/512/1828/1828884.png" onclick="copyLink('${s.url}')">
        <img src="https://cdn-icons-png.flaticon.com/512/929/929610.png" onclick="shareSound('${s.url}')">
        <img src="https://cdn-icons-png.flaticon.com/512/1214/1214428.png" onclick="deleteSound('${s.id}','${s.filePath}')">
      </div>
    </div>
  `;
}

/* ---------------- Actions ---------------- */
window.copyLink = (url) => {
  navigator.clipboard.writeText(url);
  alert("Copied!");
};

window.shareSound = async (url) => {
  if(navigator.share){
    navigator.share({title:"Sound", url});
  } else alert("Share not supported");
};

window.deleteSound = async (id, path) => {
  if(!confirm("Delete this?")) return;
  try{
    await remove(ref(db, `sounds/${id}`));
    await deleteObject(sRef(storage, path));
    alert("Deleted!");
  }catch(e){
    alert("Error deleting: "+e.message);
  }
};
</script>

</body>
</html>
